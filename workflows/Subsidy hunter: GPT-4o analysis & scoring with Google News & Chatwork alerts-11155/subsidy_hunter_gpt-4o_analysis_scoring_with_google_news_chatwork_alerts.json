{"name":"AI Subsidy Hunter: Intelligent Scoring & Alert System (Fixed Layout)","nodes":[{"id":"sticky-setup","name":"Sticky Note Setup","type":"n8n-nodes-base.stickyNote","position":[-160,624],"parameters":{"color":7,"width":400,"height":266,"content":"## 1. Setup & Trigger\nDefines the schedule (9 AM daily) and holds all configuration variables like API keys and room IDs."},"typeVersion":1},{"id":"sticky-aggregation","name":"Sticky Note Aggregation","type":"n8n-nodes-base.stickyNote","position":[352,368],"parameters":{"color":7,"width":435,"height":600,"content":"## 2. Data Aggregation\nCollects subsidy news from Google News and government RSS feeds (J-Net21, Mirasapo), then merges them into a single list."},"typeVersion":1},{"id":"sticky-analysis","name":"Sticky Note Analysis","type":"n8n-nodes-base.stickyNote","position":[848,368],"parameters":{"color":7,"width":700,"height":600,"content":"## 3. AI Analysis\nExtracts the article URL, fetches the full text, and uses **GPT-4o** to analyze, structure, and score the subsidy (1-10)."},"typeVersion":1},{"id":"sticky-logic","name":"Sticky Note Logic","type":"n8n-nodes-base.stickyNote","position":[1600,480],"parameters":{"color":7,"width":1450,"height":450,"content":"## 4. Logic, Filter & Notify\nChecks for duplicates in Google Sheets, filters by importance score (High/Normal), and sends a formatted alert to Chatwork."},"typeVersion":1},{"id":"schedule-trigger","name":"Daily Schedule (9AM)","type":"n8n-nodes-base.scheduleTrigger","position":[-48,720],"parameters":{"rule":{"interval":[{"triggerAtHour":9}]}},"typeVersion":1.2},{"id":"config","name":"Workflow Configuration","type":"n8n-nodes-base.set","position":[176,720],"parameters":{"options":{},"assignments":{"assignments":[{"id":"id-1","name":"googleNewsSearchQuery","type":"string","value":"2026Âπ¥Â∫¶ Ë£úÂä©Èáë OR Âä©ÊàêÈáë OR ‰ª§Âíå8Âπ¥Â∫¶"},{"id":"id-2","name":"jnet21RssUrl","type":"string","value":"https://j-net21.smrj.go.jp/snavi/support/support.xml"},{"id":"id-3","name":"mirasapoPlusRssUrl","type":"string","value":"https://mirasapo-plus.go.jp/subsidy/feed/"},{"id":"id-4","name":"chatworkRoomId","type":"string","value":"<__PLACEHOLDER_VALUE__Chatwork Room ID__>"},{"id":"id-5","name":"chatworkApiToken","type":"string","value":"<__PLACEHOLDER_VALUE__Chatwork API Token__>"},{"id":"id-6","name":"googleSheetsId","type":"string","value":"<__PLACEHOLDER_VALUE__Google Sheets ID__>"}]},"includeOtherFields":true},"typeVersion":3.4},{"id":"search-news","name":"Search Google News","type":"n8n-nodes-base.httpRequest","onError":"continueRegularOutput","position":[400,528],"parameters":{"url":"={{ 'https://www.google.com/search?q=' + encodeURIComponent($('Workflow Configuration').first().json.googleNewsSearchQuery) + '&tbm=nws&num=20' }}","options":{},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}]}},"typeVersion":4.3},{"id":"read-rss-1","name":"Read J-Net21 RSS","type":"n8n-nodes-base.rssFeedRead","onError":"continueRegularOutput","position":[400,720],"parameters":{"url":"={{ $('Workflow Configuration').first().json.jnet21RssUrl }}","options":{}},"typeVersion":1.2},{"id":"read-rss-2","name":"Read Mirasapo RSS","type":"n8n-nodes-base.rssFeedRead","onError":"continueErrorOutput","position":[400,912],"parameters":{"url":"={{ $('Workflow Configuration').first().json.mirasapoPlusRssUrl }}","options":{}},"typeVersion":1.2},{"id":"merge-sources","name":"Merge All Sources","type":"n8n-nodes-base.merge","position":[624,704],"parameters":{"numberInputs":3},"typeVersion":3.2},{"id":"extract-urls","name":"Extract URLs","type":"n8n-nodes-base.code","position":[848,720],"parameters":{"jsCode":"const items = $input.all();\nconst validItems = [];\n\nitems.forEach(item => {\n  let url = item.json.link || item.json.url || item.json.guid || item.json.originallink;\n\n  if (Array.isArray(url)) {\n    url = url[0];\n  }\n\n  if (url && typeof url === 'string') {\n    url = url.trim();\n\n    if (url.length > 0) {\n      validItems.push({\n        json: {\n          url: url,\n          title: (item.json.title || 'No Title').trim(),\n          source: item.json.source || 'unknown',\n          pubDate: item.json.pubDate || item.json.isoDate\n        }\n      });\n    }\n  }\n});\n\nreturn validItems;"},"typeVersion":2},{"id":"fetch-content","name":"Fetch Article Content","type":"n8n-nodes-base.httpRequest","onError":"continueErrorOutput","position":[1072,720],"parameters":{"url":"={{ $json.url }}","options":{"response":{"response":{"responseFormat":"text"}}},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}]}},"typeVersion":4.3},{"id":"ai-agent","name":"AI Scoring Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[1296,720],"parameters":{"text":"={{ $json.data }}","options":{"systemMessage":"You are an expert grant analyst. \nYour task:\n1. Extract key subsidy info (focusing on upcoming fiscal years).\n2. **EVALUATE** the subsidy's importance for SMEs (Small/Medium Enterprises).\n   - Assign an 'importanceScore' (1-10) based on budget size, ease of application, and coverage.\n   - Assign 'urgency' (High/Medium/Low) based on deadlines.\n3. Return structured JSON.\n\nFields:\n- subsidyName, fiscalYear, targetRecipients, applicationDeadline, budgetAmount, requiredDocuments, administeringAgency, eligibilityCriteria\n- importanceScore (number)\n- urgency (string)"},"promptType":"define","hasOutputParser":true},"typeVersion":1.7},{"id":"openai-model","name":"OpenAI GPT-4o","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[1312,944],"parameters":{"model":{"__rl":true,"mode":"id","value":"gpt-4o"},"options":{}},"credentials":{"openAiApi":{"id":"credential-id","name":"openAiApi Credential"}},"typeVersion":1.2},{"id":"output-parser","name":"Structured Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserStructured","position":[1440,944],"parameters":{"jsonSchemaExample":"{\n\t\"subsidyName\": \"‰∫ãÊ•≠ÂÜçÊßãÁØâË£úÂä©Èáë\",\n\t\"fiscalYear\": \"2026\",\n\t\"targetRecipients\": \"‰∏≠Â∞è‰ºÅÊ•≠\",\n\t\"applicationDeadline\": \"2026-03-31\",\n\t\"budgetAmount\": \"1000ÂÑÑÂÜÜ\",\n\t\"requiredDocuments\": [\"‰∫ãÊ•≠Ë®àÁîªÊõ∏\"],\n\t\"administeringAgency\": \"ÁµåÊ∏àÁî£Ê•≠ÁúÅ\",\n\t\"eligibilityCriteria\": \"Â£≤‰∏äÊ∏õÂ∞ë\",\n\t\"importanceScore\": 9,\n\t\"urgency\": \"High\"\n}"},"typeVersion":1.3},{"id":"check-duplicate","name":"Check Duplicate","type":"n8n-nodes-base.googleSheets","position":[1648,720],"parameters":{"title":"Ë£úÂä©Èáë„ÉªÂä©ÊàêÈáë","options":{},"resource":"spreadsheet"},"credentials":{"googleSheetsOAuth2Api":{"id":"credential-id","name":"googleSheetsOAuth2Api Credential"}},"typeVersion":4.7},{"id":"is-new","name":"Is New Subsidy?","type":"n8n-nodes-base.if","position":[1872,720],"parameters":{"options":{},"conditions":{"options":{"leftValue":"","caseSensitive":false,"typeValidation":"loose"},"combinator":"and","conditions":[{"id":"id-1","operator":{"type":"boolean","operation":"false"},"leftValue":"={{ $('Check Duplicate').all().map(item => item.json.sourceUrl).includes($('AI Scoring Agent').item.json.sourceUrl) }}"}]}},"typeVersion":2.2},{"id":"check-priority","name":"High Priority?","type":"n8n-nodes-base.if","position":[2096,720],"parameters":{"options":{},"conditions":{"options":{"leftValue":"","caseSensitive":false,"typeValidation":"loose"},"combinator":"and","conditions":[{"id":"id-1","operator":{"type":"number","operation":"gte"},"leftValue":"={{ $json.importanceScore }}","rightValue":7}]}},"typeVersion":2.2},{"id":"set-high","name":"Set High Priority","type":"n8n-nodes-base.set","position":[2320,624],"parameters":{"options":{},"assignments":{"assignments":[{"id":"id-1","name":"alertEmoji","type":"string","value":"üö®„ÄêÁ∑äÊÄ•„ÉªÈáçË¶Å„Äë"},{"id":"id-2","name":"priorityTag","type":"string","value":"High"}]},"includeOtherFields":true},"typeVersion":3.4},{"id":"set-normal","name":"Set Normal Priority","type":"n8n-nodes-base.set","position":[2320,816],"parameters":{"options":{},"assignments":{"assignments":[{"id":"id-1","name":"alertEmoji","type":"string","value":"‚ÑπÔ∏è"},{"id":"id-2","name":"priorityTag","type":"string","value":"Normal"}]},"includeOtherFields":true},"typeVersion":3.4},{"id":"save-sheet","name":"Save to Google Sheets","type":"n8n-nodes-base.googleSheets","position":[2544,720],"parameters":{"columns":{"value":null,"mappingMode":"autoMapInputData"},"options":{},"operation":"appendOrUpdate","sheetName":{"__rl":true,"mode":"name","value":"Subsidies"},"documentId":{"__rl":true,"mode":"id","value":"={{ $('Workflow Configuration').first().json.googleSheetsId }}"}},"credentials":{"googleSheetsOAuth2Api":{"id":"credential-id","name":"googleSheetsOAuth2Api Credential"}},"typeVersion":4.7},{"id":"send-chatwork","name":"Send Chatwork","type":"n8n-nodes-base.httpRequest","position":[2768,720],"parameters":{"url":"={{ $('Workflow Configuration').first().json.chatworkRoomId }}/messages","method":"POST","options":{},"sendBody":true,"contentType":"form-urlencoded","sendHeaders":true,"bodyParameters":{"parameters":[{"name":"body","value":"=[info][title]{{ $json.alertEmoji }} Êñ∞„Åó„ÅÑË£úÂä©ÈáëÊÉÖÂ†± (Score: {{ $json.importanceScore }}/10)[/title]Ë£úÂä©ÈáëÂêç: {{ $json.subsidyName }}\nÈáçË¶ÅÂ∫¶: {{ $json.priorityTag }} ({{ $json.urgency }})\nÂØæË±°: {{ $json.targetRecipients }}\nÊúüÈôê: {{ $json.applicationDeadline }}\n\nË©≥Á¥∞URL: {{ $json.sourceUrl }}[/info]"}]},"headerParameters":{"parameters":[{"name":"X-ChatWorkToken","value":"={{ $('Workflow Configuration').first().json.chatworkApiToken }}"}]}},"typeVersion":4.3},{"id":"sticky-main","name":"Sticky Note Main","type":"n8n-nodes-base.stickyNote","position":[-320,-128],"parameters":{"width":550,"height":701,"content":"# AI Subsidy Hunter: Intelligent Scoring & Alert\n\n## Overview\nThis workflow goes beyond simple scraping. It uses **OpenAI (GPT-4o)** to analyze subsidy/grant information from Google News and RSS feeds, scoring them based on importance for SMEs.\n\n## How it works\n1. **Collect:** Aggregates info from Google News, J-Net21, and Mirasapo Plus.\n2. **Analyze (AI Agent):** GPT-4o extracts key details and calculates an `importanceScore` (1-10) and `urgency`.\n3. **Filter:** Checks Google Sheets to prevent duplicates.\n4. **Prioritize:** If the score is 7 or higher, it tags the alert as \"High Priority\" (üö®).\n5. **Notify:** Saves to Google Sheets and sends a formatted alert to Chatwork.\n\n## Setup Steps\n1. **Google Sheets:** Create a sheet named `Subsidies` with these headers:\n   - `subsidyName`, `targetRecipients`, `applicationDeadline`, `budgetAmount`, `urgency`, `importanceScore`, `priorityTag`, `sourceUrl`\n2. **Credentials:** Connect **OpenAI**, **Google Sheets**, and obtain your **Chatwork API Token**.\n3. **Configuration:** Open the **\"Workflow Configuration\"** node and enter your `Chatwork Room ID`, `API Token`, and `Google Sheet ID`.\n\n## Requirements\n- OpenAI API Key\n- Chatwork Account\n- Google Sheets"},"typeVersion":1}],"pinData":{},"connections":{"Extract URLs":{"main":[[{"node":"Fetch Article Content","type":"main","index":0}]]},"OpenAI GPT-4o":{"ai_languageModel":[[{"node":"AI Scoring Agent","type":"ai_languageModel","index":0}]]},"High Priority?":{"main":[[{"node":"Set High Priority","type":"main","index":0}],[{"node":"Set Normal Priority","type":"main","index":0}]]},"Check Duplicate":{"main":[[{"node":"Is New Subsidy?","type":"main","index":0}]]},"Is New Subsidy?":{"main":[[{"node":"High Priority?","type":"main","index":0}]]},"AI Scoring Agent":{"main":[[{"node":"Check Duplicate","type":"main","index":0}]]},"Read J-Net21 RSS":{"main":[[{"node":"Merge All Sources","type":"main","index":1}]]},"Merge All Sources":{"main":[[{"node":"Extract URLs","type":"main","index":0}]]},"Read Mirasapo RSS":{"main":[[{"node":"Merge All Sources","type":"main","index":2}]]},"Set High Priority":{"main":[[{"node":"Save to Google Sheets","type":"main","index":0}]]},"Search Google News":{"main":[[{"node":"Merge All Sources","type":"main","index":0}]]},"Set Normal Priority":{"main":[[{"node":"Save to Google Sheets","type":"main","index":0}]]},"Daily Schedule (9AM)":{"main":[[{"node":"Workflow Configuration","type":"main","index":0}]]},"Fetch Article Content":{"main":[[{"node":"AI Scoring Agent","type":"main","index":0}]]},"Save to Google Sheets":{"main":[[{"node":"Send Chatwork","type":"main","index":0}]]},"Workflow Configuration":{"main":[[{"node":"Search Google News","type":"main","index":0},{"node":"Read J-Net21 RSS","type":"main","index":0},{"node":"Read Mirasapo RSS","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Scoring Agent","type":"ai_outputParser","index":0}]]}}}